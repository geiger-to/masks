<div data-controller="dialog" data-action="click->dialog#backdropClose">
  <div class="mb-4 flex items-center gap-2">
    <%= lucide_icon('user', class: 'w-5 h-5') %>

    <h1 class="font-bold">
      actors
    </h1>

    <%= form_with url: admin_actors_path, method: :get, class: 'flex-grow ml-2 flex gap-2 items-center' do |f| %>
      <label class="input input-sm flex items-center gap-2 flex-grow">
        <input type="text" name="q" class="w-full flex-grow" placeholder="search by identifier or device..." value="<%= params[:q] %>" />

        <button type="submit" class="btn btn-ghost btn-xs -mr-2" value="search">
          <%= lucide_icon('search', size: 16) %>
        </button>
      </label>
    <% end %>

    <button class="btn btn-sm btn-ghost btn-primary" data-action="dialog#open">
      <span class="">
        <%= lucide_icon('plus-square', class: 'w-5 h-5') %>
      </span>

      new
    </button>
  </div>

  <%= render('masks/admin/alert/errors', heading: 'failed to create actor...', class: 'mb-2') %>

  <dialog class="modal" data-dialog-target="dialog">
    <div class="modal-box">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"><%= lucide_icon('x') %></button>
      </form>

      <h3 class="mb-4 ml-1 font-bold flex items-center gap-2">
        <%= lucide_icon('user-plus', size: 16) %>
        new actor
      </h3>

      <%= form_with url: admin_actors_path, method: :post do |form| %>
        <label class="form-control input input-bordered flex flex-row gap-4 items-center flex-grow mb-2">
          identifier

          <input placeholder="enter an identifier for the actor (nickname, email, etc)..." type="text" name="nickname" class="grow">
        </label>

        <label class="form-control input input-bordered w-full flex flex-row items-center gap-4 mb-4" data-controller="password-visibility">
          password

          <input
            type="password"
            data-password-visibility-target="input"
            spellcheck="false"
            placeholder="enter a password..."
            name="password"
            class="flex-grow">

          <button data-action="password-visibility#toggle" type="button" class="btn btn-sm btn-ghost -mr-2">
            <span data-password-visibility-target="icon"><%= lucide_icon('eye') %></span>
            <span data-password-visibility-target="icon" class="hidden"><%= lucide_icon('eye-off') %></span>
          </button>
        </label>

        <div class="modal-actions">
          <input type="submit" class="btn btn-sm btn-success" value="save">
        </div>
      <% end %>
    </div>
  </dialog>

  <div class="overflow-x-auto -mx-6 md:mx-0">
    <table class="table bg-base-100 rounded-none md:rounded-lg md:table-sm table-xs [&_td]:py-3 [&_td]:px-4 [&_thead_td]:py-2">
      <!-- head -->
      <thead>
        <tr>
          <td>name</td>
          <td class="text-right">last login</td>
        </tr>
      </thead>
      <tbody>
        <% @actors.each do |actor| %>
          <tr data-action="click->table#click" data-controller="table" class="cursor-pointer">
            <td class="<%= actor.last_login_at ? "font-bold" : "opacity-75" %>">
              <a data-table-target="url" href="<%= admin_actor_path(actor.identifier.value) %>"><%= actor.identifier.value %></a>
            </td>
            <td class="text-xs whitespace-nowrap text-right">
              <% if actor.last_login_at %>
                <%= time_ago_in_words(actor.last_login_at) %> ago
              <% else %>
                <span class="opacity-75">never logged in</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @pagy.pages > 1 %>
    <%== pagy_nav(@pagy) %>
  <% end %>
</div>
