<div>
  <%= form_with url: session_path, method: :post, data: { turbo: false } do |form| %>
    <div role="alert" class="alert mb-4 text-left" data-session-target="flash">
      <% if flash[:errors]&.any? && !factor2_required? %>
        <div class="flex items-center gap-4">
          <%= lucide_icon("shield-x", class: "stroke-error") %>
          <span><%= flash[:errors][0] %></span>
        </div>
      <% elsif logged_in? %>
        <div class="flex items-center gap-4">
          <%= lucide_icon("check", class: "stroke-success") %>
          <span><%= t(".logged_in") %></span>
        </div>
      <% elsif signup? %>
        <div class="flex items-center gap-4">
          <%= lucide_icon("user-plus", class: "stroke-success") %>
          <span><%= t(".signup") %></span>
        </div>
      <% elsif params.dig(:session, :identifier) && password_required? %>
        <div data-flash="enter-password" class="flex items-center gap-4">
          <%= lucide_icon("shield-ellipsis", class: "stroke-warning") %>
          <span><%= t(".enter_password") %></span>
        </div>
      <% elsif masks_settings['signups.enabled'] %>
        <div data-flash="enter-credentials" class="flex items-center gap-4">
          <%= lucide_icon("shield-alert", class: "stroke-warning") %>
          <span><%= t(".login_or_signup") %></span>
        </div>
      <% else %>
        <div data-flash="enter-credentials" class="flex items-center gap-4">
          <%= lucide_icon("shield-alert", class: "stroke-warning") %>
          <span><%= t(".enter_credentials") %></span>
        </div>
      <% end %>
    </div>

    <% if factor2_required? %>
      <%= render('factor2') %>
    <% elsif !logged_in? %>
      <div class="flex flex-col gap-2">
        <label class="form-control w-full">
          <input
            type="text"
            data-action="session#updateNickname"
            data-session-target="nickname"
            placeholder="<%= t(".placeholder.#{@identifier}") %>"
            name="session[identifier]"
            class="input input-bordered w-full">
        </label>

        <label class="form-control input input-bordered w-full flex flex-row items-center gap-2 mb-2" data-controller="password-visibility">
          <input
            type="password"
            data-action="session#updatePassword"
            data-session-target="password"
            data-password-visibility-target="input"
            spellcheck="false"
            placeholder="<%= t('.placeholder.password') %>"
            name="session[password]"
            class="flex-grow">

          <button data-action="password-visibility#toggle" type="button" class="btn btn-sm btn-ghost -mr-2">
            <span data-password-visibility-target="icon"><%= lucide_icon('eye') %></span>
            <span data-password-visibility-target="icon" class="hidden"><%= lucide_icon('eye-off') %></span>
          </button>
        </label>
        <div class="flex items-start gap-4 ">
          <div class="flex-grow">
            <%= form.submit t(".submit"),
                        class: "btn btn-active",
                        data: {
                          session_target: "submit",
                        } %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>

  <% if factor2_required? %>
    <div class="mt-2 opacity-60 hover:opacity-100">
      <%= form_with url: session_path, method: :delete do |form| %>
        <span class="text-xs">
          <%= t(".start_over.text") %>
          <%= form.submit t(".start_over.link"), class: "cursor-pointer underline" %>
        </span>

      <% end %>
    </div>
  <% end %>
</div>
